"use strict";(self["webpackChunk_mitre_heimdall_lite"]=self["webpackChunk_mitre_heimdall_lite"]||[]).push([[537],{93537:function(e,t,r){r.d(t,{EventStreamSerde:function(){return s}});var i=r(70351),n=r(90650);class s{marshaller;serializer;deserializer;serdeContext;defaultContentType;constructor({marshaller:e,serializer:t,deserializer:r,serdeContext:i,defaultContentType:n}){this.marshaller=e,this.serializer=t,this.deserializer=r,this.serdeContext=i,this.defaultContentType=n}async serializeEventStream({eventStream:e,requestSchema:t,initialRequest:r}){const i=this.marshaller,n=t.getEventStreamMember(),s=t.getMemberSchema(n),a=this.serializer,o=this.defaultContentType,l=Symbol("initialRequestMarker"),c={async*[Symbol.asyncIterator](){if(r){const e={":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:o}};a.write(t,r);const i=a.flush();yield{[l]:!0,headers:e,body:i}}for await(const t of e)yield t}};return i.serialize(c,e=>{if(e[l])return{headers:e.headers,body:e.body};const t=Object.keys(e).find(e=>"__type"!==e)??"",{additionalHeaders:r,body:i,eventType:n,explicitPayloadContentType:a}=this.writeEventBody(t,s,e),c={":event-type":{type:"string",value:n},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:a??o},...r};return{headers:c,body:i}})}async deserializeEventStream({response:e,responseSchema:t,initialResponseContainer:r}){const n=this.marshaller,s=t.getEventStreamMember(),a=t.getMemberSchema(s),o=a.getMemberSchemas(),l=Symbol("initialResponseMarker"),c=n.deserialize(e.body,async e=>{const r=Object.keys(e).find(e=>"__type"!==e)??"",n=e[r].body;if("initial-response"===r){const e=await this.deserializer.read(t,n);return delete e[s],{[l]:!0,...e}}if(r in o){const t=o[r];if(t.isStructSchema()){const s={};let a=!1;for(const[o,l]of t.structIterator()){const{eventHeader:t,eventPayload:c}=l.getMergedTraits();if(a=a||Boolean(t||c),c)l.isBlobSchema()?s[o]=n:l.isStringSchema()?s[o]=(this.serdeContext?.utf8Encoder??i.P)(n):l.isStructSchema()&&(s[o]=await this.deserializer.read(l,n));else if(t){const t=e[r].headers[o]?.value;null!=t&&(l.isNumericSchema()?s[o]=t&&"object"===typeof t&&"bytes"in t?BigInt(t.toString()):Number(t):s[o]=t)}}if(a)return{[r]:s}}return{[r]:await this.deserializer.read(t,n)}}return{$unknown:e}}),d=c[Symbol.asyncIterator](),m=await d.next();if(m.done)return c;if(m.value?.[l]){if(!t)throw new Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(const[e,t]of Object.entries(m.value))r[e]=t}return{async*[Symbol.asyncIterator](){m?.value?.[l]||(yield m.value);while(1){const{done:e,value:t}=await d.next();if(e)break;yield t}}}}writeEventBody(e,t,r){const i=this.serializer;let s,a=e,o=null;const l=(()=>{const r=t.getSchema();return r[4].includes(e)})(),c={};if(l){const n=t.getMemberSchema(e);if(!n.isStructSchema())throw new Error("@smithy/core/event-streams - non-struct member not supported in event stream union.");for(const[t,i]of n.structIterator()){const{eventHeader:n,eventPayload:s}=i.getMergedTraits();if(s)o=t;else if(n){const n=r[e][t];let s="binary";i.isNumericSchema()?s=(-2)**31<=n&&n<=2**31-1?"integer":"long":i.isTimestampSchema()?s="timestamp":i.isStringSchema()?s="string":i.isBooleanSchema()&&(s="boolean"),null!=n&&(c[t]={type:s,value:n},delete r[e][t])}}if(null!==o){const t=n.getMemberSchema(o);t.isBlobSchema()?s="application/octet-stream":t.isStringSchema()&&(s="text/plain"),i.write(t,r[e][o])}else i.write(n,r[e])}else{const[t,n]=r[e];a=t,i.write(15,n)}const d=i.flush(),m="string"===typeof d?(this.serdeContext?.utf8Decoder??n.a)(d):d;return{body:m,eventType:a,explicitPayloadContentType:s,additionalHeaders:c}}}}}]);
//# sourceMappingURL=537-legacy.df56feb5.js.map